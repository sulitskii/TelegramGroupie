# System Architecture

## ğŸ—ï¸ **High-Level Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TELEGRAM TO WHATSAPP BRIDGE                         â”‚
â”‚                           Secure Message Pipeline                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           TELEGRAM API              â”‚
                    â”‚     (Webhook Integration)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ HTTPS POST
                                      â”‚ /webhook/{secret}
                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         FLASK APPLICATION                           â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚   Webhook       â”‚  â”‚   Message       â”‚  â”‚   API Endpoints     â”‚ â”‚
    â”‚  â”‚   Handler       â”‚  â”‚   Processing    â”‚  â”‚   (/messages)       â”‚ â”‚
    â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                     â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚             â”‚
                    â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   GOOGLE CLOUD      â”‚ â”‚   GOOGLE CLOUD      â”‚ â”‚    WHATSAPP         â”‚
    â”‚     FIRESTORE       â”‚ â”‚        KMS          â”‚ â”‚   BUSINESS API      â”‚
    â”‚                     â”‚ â”‚                     â”‚ â”‚                     â”‚
    â”‚ â€¢ Message Storage   â”‚ â”‚ â€¢ Encryption Keys   â”‚ â”‚ â€¢ Message Delivery  â”‚
    â”‚ â€¢ Metadata          â”‚ â”‚ â€¢ Secure Encryption â”‚ â”‚ â€¢ Group Management  â”‚
    â”‚ â€¢ Search/Query      â”‚ â”‚ â€¢ Key Management    â”‚ â”‚ â€¢ Status Updates    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **Message Flow Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MESSAGE FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. TELEGRAM MESSAGE RECEIVED
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User sends  â”‚ â”€â”€â”
   â”‚ message to  â”‚   â”‚
   â”‚ Telegram    â”‚   â”‚
   â”‚ group       â”‚   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                     â”‚ Webhook POST
                     â–¼
2. WEBHOOK PROCESSING        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚         FLASK APP               â”‚
   â”‚ Validate    â”‚ â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                                 â”‚
   â”‚ webhook     â”‚          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ secret      â”‚          â”‚ â”‚    process_message()        â”‚ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚                             â”‚ â”‚
                            â”‚ â”‚ â€¢ Extract message data      â”‚ â”‚
                            â”‚ â”‚ â€¢ Get user info             â”‚ â”‚
                            â”‚ â”‚ â€¢ Get chat info             â”‚ â”‚
                            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
3. ENCRYPTION                                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Google      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      encryption.encrypt()      â”‚
   â”‚ Cloud KMS   â”‚          â”‚                                 â”‚
   â”‚             â”‚          â”‚ â€¢ Generate unique DEK          â”‚
   â”‚ â€¢ DEK       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ Encrypt message text          â”‚
   â”‚ â€¢ Envelope  â”‚          â”‚ â€¢ Return encrypted data         â”‚
   â”‚   Encryptionâ”‚          â”‚   - ciphertext                  â”‚
   â”‚   - encrypted_data_key          â”‚
   â”‚   - initialization_vector       â”‚
   â”‚   - salt                        â”‚
   â”‚   - encrypted_data_key          â”‚
   â”‚   - initialization_vector       â”‚
   â”‚   - salt                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   - encrypted_data_key          â”‚
                            â”‚   - initialization_vector       â”‚
                            â”‚   - salt                        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
4. STORAGE                                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Google      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      db.collection().add()     â”‚
   â”‚ Cloud       â”‚          â”‚                                 â”‚
   â”‚ Firestore   â”‚          â”‚ Document Structure:             â”‚
   â”‚             â”‚          â”‚ {                               â”‚
   â”‚ Collection: â”‚          â”‚   message_id: 12345,            â”‚
   â”‚ "messages"  â”‚          â”‚   chat_id: -100123456789,       â”‚
   â”‚             â”‚          â”‚   user_id: 987654321,           â”‚
   â”‚             â”‚          â”‚   encrypted_text: {             â”‚
   â”‚             â”‚          â”‚     ciphertext: "...",          â”‚
   â”‚             â”‚          â”‚     encrypted_data_key: "...",  â”‚
   â”‚             â”‚          â”‚     iv: "...",                  â”‚
   â”‚             â”‚          â”‚     salt: "..."                 â”‚
   â”‚             â”‚          â”‚   },                            â”‚
   â”‚             â”‚          â”‚   timestamp: "2024-01-01T...",  â”‚
   â”‚             â”‚          â”‚   type: "telegram"              â”‚
   â”‚             â”‚          â”‚ }                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. WHATSAPP DELIVERY (Future Implementation)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ WhatsApp    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     Send to WhatsApp Groups     â”‚
   â”‚ Business    â”‚          â”‚                                 â”‚
   â”‚ API         â”‚          â”‚ â€¢ Decrypt message               â”‚
   â”‚             â”‚          â”‚ â€¢ Format for WhatsApp           â”‚
   â”‚             â”‚          â”‚ â€¢ Send to target groups         â”‚
   â”‚             â”‚          â”‚ â€¢ Handle delivery status        â”‚
   â”‚             â”‚          â”‚ â€¢ Decrypt message               â”‚
   â”‚             â”‚          â”‚ â€¢ Format for WhatsApp           â”‚
   â”‚             â”‚          â”‚ â€¢ Send to target groups         â”‚
   â”‚             â”‚          â”‚ â€¢ Handle delivery status        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª **Testing Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              TESTING MODES                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRODUCTION MODE                          TESTING MODE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    REAL SERVICES    â”‚                 â”‚   MOCK SERVICES     â”‚
â”‚                     â”‚                 â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Google Cloud    â”‚ â”‚                 â”‚ â”‚ Mock Firestore  â”‚ â”‚
â”‚ â”‚ Firestore       â”‚ â”‚                 â”‚ â”‚ Client          â”‚ â”‚
â”‚ â”‚ â€¢ Real database â”‚ â”‚                 â”‚ â”‚ â€¢ In-memory     â”‚ â”‚
â”‚ â”‚ â€¢ Network calls â”‚ â”‚ â”€â”€â”€â”€REPLACEDâ”€â”€â–¶ â”‚ â”‚   storage       â”‚ â”‚
â”‚ â”‚ â€¢ Authenticationâ”‚ â”‚     WITH        â”‚ â”‚ â€¢ No network    â”‚ â”‚
â”‚ â”‚ â€¢ GCP billing   â”‚ â”‚                 â”‚ â”‚ â€¢ Fast startup  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                 â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Google Cloud    â”‚ â”‚                 â”‚ â”‚ Mock Encryption â”‚ â”‚
â”‚ â”‚ KMS             â”‚ â”‚                 â”‚ â”‚ â€¢ Base64 encode â”‚ â”‚
â”‚ â”‚ â€¢ HSM encryptionâ”‚ â”‚ â”€â”€â”€â”€REPLACEDâ”€â”€â–¶ â”‚ â”‚ â€¢ No GCP calls  â”‚ â”‚
â”‚ â”‚ â€¢ Key managementâ”‚ â”‚     WITH        â”‚ â”‚ â€¢ Deterministic â”‚ â”‚
â”‚ â”‚ â€¢ IAM policies  â”‚ â”‚                 â”‚ â”‚ â€¢ Test-friendly â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                 â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Telegram Bot    â”‚ â”‚                 â”‚ â”‚ Mock Telegram   â”‚ â”‚
â”‚ â”‚ â€¢ Real bot API  â”‚ â”‚                 â”‚ â”‚ App             â”‚ â”‚
â”‚ â”‚ â€¢ Rate limits   â”‚ â”‚ â”€â”€â”€â”€REPLACEDâ”€â”€â–¶ â”‚ â”‚ â€¢ No-op methods â”‚ â”‚
â”‚ â”‚ â€¢ Network deps  â”‚ â”‚     WITH        â”‚ â”‚ â€¢ Test webhooks â”‚ â”‚
â”‚ â”‚ â€¢ Token requiredâ”‚ â”‚                 â”‚ â”‚ â€¢ Offline tests â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ENVIRONMENT DETECTION:
if os.environ.get('TESTING') == 'true':
    # Use mock implementations
else:
    # Use real Google Cloud services
```

## ğŸ³ **Docker Testing Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DOCKER TEST ENVIRONMENT                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONTAINER ORCHESTRATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    TEST RUNNER      â”‚â”€â”€â”€â”€â–¶â”‚    APPLICATION      â”‚â”€â”€â”€â”€â–¶â”‚   TEST RESULTS      â”‚
â”‚                     â”‚     â”‚     CONTAINER       â”‚     â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ pytest          â”‚ â”‚     â”‚ â”‚ Flask App       â”‚ â”‚     â”‚ â”‚ JUnit XML       â”‚ â”‚
â”‚ â”‚ HTTP requests   â”‚ â”‚     â”‚ â”‚ Mock services   â”‚ â”‚     â”‚ â”‚ HTML reports    â”‚ â”‚
â”‚ â”‚ Integration     â”‚ â”‚     â”‚ â”‚ TESTING=true    â”‚ â”‚     â”‚ â”‚ Coverage data   â”‚ â”‚
â”‚ â”‚ tests           â”‚ â”‚     â”‚ â”‚ Port 8080       â”‚ â”‚     â”‚ â”‚ Logs            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                           â”‚                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   DOCKER NETWORK    â”‚
                            â”‚    test-network     â”‚
                            â”‚                     â”‚
                            â”‚ â€¢ Container-to-     â”‚
                            â”‚   container comms   â”‚
                            â”‚ â€¢ Isolated testing  â”‚
                            â”‚ â€¢ No external deps  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TEST EXECUTION FLOW:
1. docker-compose up --build
2. Build application container with TESTING=true
3. Start test runner container
4. Test runner makes HTTP requests to app container
5. Application responds using mock services
6. Test results written to shared volume
7. Containers shut down automatically
```

## ğŸ­ **CI/CD Pipeline Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CI/CD PIPELINE                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GITHUB ACTIONS WORKFLOW
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TRIGGER   â”‚â”€â”€â”€â–¶â”‚    BUILD    â”‚â”€â”€â”€â–¶â”‚    TEST     â”‚â”€â”€â”€â–¶â”‚   DEPLOY    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼                   â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ git push  â”‚    â”‚ â€¢ Python    â”‚    â”‚ â€¢ Unit      â”‚    â”‚ â€¢ Google    â”‚
â”‚ â€¢ PR create â”‚    â”‚   3.11      â”‚    â”‚   tests     â”‚    â”‚   Cloud     â”‚
â”‚ â€¢ scheduled â”‚    â”‚ â€¢ pip       â”‚    â”‚ â€¢ Integration â”‚   â”‚   Run       â”‚
â”‚   runs      â”‚    â”‚   install   â”‚    â”‚   tests     â”‚    â”‚ â€¢ Container â”‚
â”‚             â”‚    â”‚ â€¢ lint      â”‚    â”‚ â€¢ Docker    â”‚    â”‚   Registry  â”‚
â”‚             â”‚    â”‚ â€¢ format    â”‚    â”‚   tests     â”‚    â”‚ â€¢ Health    â”‚
â”‚             â”‚    â”‚ â€¢ deps      â”‚    â”‚ â€¢ Coverage  â”‚    â”‚   checks    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PARALLEL TEST MATRIX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           TEST EXECUTION                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Unit      â”‚  â”‚ Integration â”‚  â”‚   Docker    â”‚  â”‚   E2E       â”‚       â”‚
â”‚  â”‚   Tests     â”‚  â”‚   Tests     â”‚  â”‚   Tests     â”‚  â”‚   Tests     â”‚       â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚       â”‚
â”‚  â”‚ â€¢ Fast      â”‚  â”‚ â€¢ Mock      â”‚  â”‚ â€¢ Container â”‚  â”‚ â€¢ Full      â”‚       â”‚
â”‚  â”‚ â€¢ Isolated  â”‚  â”‚   services  â”‚  â”‚   testing   â”‚  â”‚   pipeline  â”‚       â”‚
â”‚  â”‚ â€¢ Coverage  â”‚  â”‚ â€¢ HTTP API  â”‚  â”‚ â€¢ Network   â”‚  â”‚ â€¢ Real      â”‚       â”‚
â”‚  â”‚ â€¢ 32 tests  â”‚  â”‚ â€¢ Real flow â”‚  â”‚   isolation â”‚  â”‚   deploy    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” **Security Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SECURITY LAYERS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRANSPORT SECURITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTPS/TLS 1.3 (Telegram â†â†’ Flask â†â†’ Google Cloud)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APPLICATION SECURITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   WEBHOOK       â”‚  â”‚   ENDPOINT      â”‚  â”‚       INPUT                 â”‚ â”‚
â”‚ â”‚   VALIDATION    â”‚  â”‚   SECURITY      â”‚  â”‚    VALIDATION               â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ Secret token  â”‚  â”‚ â€¢ Rate limiting â”‚  â”‚ â€¢ Message size limits       â”‚ â”‚
â”‚ â”‚ â€¢ Path hiding   â”‚  â”‚ â€¢ CORS policy   â”‚  â”‚ â€¢ Content sanitization      â”‚ â”‚
â”‚ â”‚ â€¢ IP filtering  â”‚  â”‚ â€¢ Auth required â”‚  â”‚ â€¢ SQL injection prevention  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATA SECURITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ENCRYPTION AT REST                                â”‚
â”‚                                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  PLAINTEXT      â”‚  KMS    â”‚   ENCRYPTED     â”‚ Firestore â”‚   STORAGE     â”‚ â”‚
â”‚ â”‚   MESSAGE       â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚   MESSAGE       â”‚ â”€â”€â”€â”€â”€â”€â–¶  â”‚   LAYER       â”‚ â”‚
â”‚ â”‚                 â”‚ Encrypt â”‚                 â”‚ Store    â”‚               â”‚ â”‚
â”‚ â”‚ "Hello World"   â”‚         â”‚ {               â”‚          â”‚ Collection:   â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚   ciphertext,   â”‚          â”‚ "messages"    â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚   encrypted_key,â”‚          â”‚               â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚   iv,           â”‚          â”‚ + Firestore   â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚   salt          â”‚          â”‚   encryption  â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚ }               â”‚          â”‚ + Disk        â”‚ â”‚
â”‚ â”‚                 â”‚         â”‚                 â”‚          â”‚   encryption  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚ DECRYPTION FLOW (Reverse)                                                   â”‚
â”‚ Storage â†’ Firestore â†’ Envelope Decryption â†’ KMS â†’ Plaintext                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ACCESS CONTROL
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  GOOGLE CLOUD   â”‚  â”‚   SERVICE       â”‚  â”‚      PRINCIPLE OF           â”‚ â”‚
â”‚ â”‚     IAM         â”‚  â”‚   ACCOUNTS      â”‚  â”‚    LEAST PRIVILEGE          â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ Role-based    â”‚  â”‚ â€¢ Firestore     â”‚  â”‚ â€¢ Minimal permissions       â”‚ â”‚
â”‚ â”‚   access        â”‚  â”‚   read/write    â”‚  â”‚ â€¢ No admin access           â”‚ â”‚
â”‚ â”‚ â€¢ Resource      â”‚  â”‚ â€¢ KMS encrypt/  â”‚  â”‚ â€¢ Audit logging             â”‚ â”‚
â”‚ â”‚   scoping       â”‚  â”‚   decrypt only  â”‚  â”‚ â€¢ Regular rotation          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š **Data Model Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             DATA MODEL                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FIRESTORE COLLECTION: "messages"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DOCUMENT                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ document_id: "auto-generated-uuid"                                     â”‚ â”‚
â”‚ â”‚ {                                                                       â”‚ â”‚
â”‚ â”‚   message_id: 12345,              // Telegram message ID               â”‚ â”‚
â”‚ â”‚   chat_id: -100123456789,         // Telegram chat ID (negative)       â”‚ â”‚
â”‚ â”‚   chat_title: "Test Group",       // Human-readable chat name          â”‚ â”‚
â”‚ â”‚   user_id: 987654321,             // Telegram user ID                  â”‚ â”‚
â”‚ â”‚   username: "john_doe",           // Telegram username                  â”‚ â”‚
â”‚ â”‚   encrypted_text: {               // Encrypted message content          â”‚ â”‚
â”‚ â”‚     ciphertext: "base64...",      // AES-256 encrypted text             â”‚ â”‚
â”‚ â”‚     encrypted_data_key: "...",    // KMS-encrypted DEK                  â”‚ â”‚
â”‚ â”‚     iv: "hex...",                 // Initialization vector              â”‚ â”‚
â”‚ â”‚     salt: "hex..."                // Salt for key derivation            â”‚ â”‚
â”‚ â”‚   },                                                                    â”‚ â”‚
â”‚ â”‚   timestamp: "2024-01-01T12:00:00Z", // ISO 8601 timestamp             â”‚ â”‚
â”‚ â”‚   type: "telegram",               // Message source type                â”‚ â”‚
â”‚ â”‚   metadata: {                     // Optional metadata                  â”‚ â”‚
â”‚ â”‚     reply_to_message_id: 12344,   // If replying to another message     â”‚ â”‚
â”‚ â”‚     forwarded_from: "channel",    // If forwarded                       â”‚ â”‚
â”‚ â”‚     has_media: false,             // If contains media                  â”‚ â”‚
â”‚ â”‚     message_type: "text"          // text, photo, video, etc.           â”‚ â”‚
â”‚ â”‚   }                                                                     â”‚ â”‚
â”‚ â”‚ }                                                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INDEXING STRATEGY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRIMARY INDEXES (Automatic)                                                â”‚
â”‚ â€¢ document_id (unique)                                                      â”‚
â”‚                                                                             â”‚
â”‚ COMPOSITE INDEXES (firestore.indexes.json)                                 â”‚
â”‚ â€¢ [chat_id, timestamp] - For chat message retrieval                        â”‚
â”‚ â€¢ [user_id, timestamp] - For user message retrieval                        â”‚
â”‚ â€¢ [chat_id, user_id, timestamp] - For filtered queries                     â”‚
â”‚ â€¢ [type, timestamp] - For message type filtering                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QUERY PATTERNS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. GET RECENT MESSAGES FROM CHAT                                           â”‚
â”‚    db.collection('messages')                                               â”‚
â”‚      .where('chat_id', '==', -100123456789)                               â”‚
â”‚      .orderBy('timestamp', 'desc')                                         â”‚
â”‚      .limit(100)                                                           â”‚
â”‚                                                                             â”‚
â”‚ 2. GET USER MESSAGES ACROSS CHATS                                          â”‚
â”‚    db.collection('messages')                                               â”‚
â”‚      .where('user_id', '==', 987654321)                                    â”‚
â”‚      .orderBy('timestamp', 'desc')                                         â”‚
â”‚      .limit(50)                                                            â”‚
â”‚                                                                             â”‚
â”‚ 3. PAGINATED RETRIEVAL                                                     â”‚
â”‚    db.collection('messages')                                               â”‚
â”‚      .where('chat_id', '==', -100123456789)                               â”‚
â”‚      .orderBy('timestamp', 'desc')                                         â”‚
â”‚      .startAfter(last_document)                                            â”‚
â”‚      .limit(100)                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **Deployment Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PRODUCTION DEPLOYMENT                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GOOGLE CLOUD RUN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚    TRAFFIC      â”‚  â”‚   CONTAINER     â”‚  â”‚         SCALING             â”‚ â”‚
â”‚ â”‚  MANAGEMENT     â”‚  â”‚   INSTANCES     â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ Load          â”‚  â”‚ â€¢ Flask app     â”‚  â”‚ â€¢ 0-1000 instances          â”‚ â”‚
â”‚ â”‚   balancing     â”‚  â”‚ â€¢ Python 3.11   â”‚  â”‚ â€¢ Auto-scaling based on     â”‚ â”‚
â”‚ â”‚ â€¢ TLS           â”‚  â”‚ â€¢ Docker        â”‚  â”‚   CPU/memory/requests       â”‚ â”‚
â”‚ â”‚   termination   â”‚  â”‚   container     â”‚  â”‚ â€¢ Cold start: ~2 seconds    â”‚ â”‚
â”‚ â”‚ â€¢ Health        â”‚  â”‚ â€¢ Memory: 512MB â”‚  â”‚ â€¢ Warm instances for        â”‚ â”‚
â”‚ â”‚   checks        â”‚  â”‚ â€¢ CPU: 1 vCPU   â”‚  â”‚   better performance        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REGIONAL AVAILABILITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRIMARY: us-central1 (Iowa)                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  CLOUD RUN      â”‚  â”‚   FIRESTORE     â”‚  â”‚         KMS                 â”‚ â”‚
â”‚ â”‚   SERVICE       â”‚  â”‚   DATABASE      â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ Multi-zone    â”‚  â”‚ â€¢ Multi-region  â”‚  â”‚ â€¢ Global key management     â”‚ â”‚
â”‚ â”‚   deployment    â”‚  â”‚   replication   â”‚  â”‚ â€¢ Hardware security         â”‚ â”‚
â”‚ â”‚ â€¢ 99.95% SLA    â”‚  â”‚ â€¢ 99.999% SLA   â”‚  â”‚   modules (HSM)             â”‚ â”‚
â”‚ â”‚ â€¢ Automatic     â”‚  â”‚ â€¢ Consistent    â”‚  â”‚ â€¢ Automatic key rotation    â”‚ â”‚
â”‚ â”‚   failover      â”‚  â”‚   backups       â”‚  â”‚ â€¢ Audit logging             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MONITORING & OBSERVABILITY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   CLOUD         â”‚  â”‚   ERROR         â”‚  â”‚       ALERTING              â”‚ â”‚
â”‚ â”‚  MONITORING     â”‚  â”‚  REPORTING      â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ Request       â”‚  â”‚ â€¢ Exception     â”‚  â”‚ â€¢ PagerDuty integration     â”‚ â”‚
â”‚ â”‚   metrics       â”‚  â”‚   tracking      â”‚  â”‚ â€¢ Slack notifications       â”‚ â”‚
â”‚ â”‚ â€¢ Latency       â”‚  â”‚ â€¢ Stack traces  â”‚  â”‚ â€¢ Email alerts              â”‚ â”‚
â”‚ â”‚ â€¢ Error rates   â”‚  â”‚ â€¢ User context  â”‚  â”‚ â€¢ Escalation policies       â”‚ â”‚
â”‚ â”‚ â€¢ Custom        â”‚  â”‚ â€¢ Performance   â”‚  â”‚ â€¢ Incident management       â”‚ â”‚
â”‚ â”‚   dashboards    â”‚  â”‚   insights      â”‚  â”‚ â€¢ SLO/SLI monitoring        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **API Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API DESIGN                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REST ENDPOINTS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚ GET /healthz                           â”‚ Health check endpoint              â”‚
â”‚ â”œâ”€ Returns: {"status": "ok"}           â”‚ Used by load balancers             â”‚
â”‚ â””â”€ Response time: <10ms                â”‚ No authentication required         â”‚
â”‚                                        â”‚                                    â”‚
â”‚ POST /webhook/{secret}                 â”‚ Telegram webhook receiver          â”‚
â”‚ â”œâ”€ Auth: Secret token in URL           â”‚ Processes incoming messages        â”‚
â”‚ â”œâ”€ Body: Telegram Update JSON          â”‚ Validates webhook signature        â”‚
â”‚ â””â”€ Returns: {"status": "ok"}           â”‚ Triggers message processing         â”‚
â”‚                                        â”‚                                    â”‚
â”‚ GET /messages                          â”‚ Message retrieval endpoint         â”‚
â”‚ â”œâ”€ Query params:                       â”‚ Supports filtering and pagination  â”‚
â”‚ â”‚  â€¢ chat_id (optional)               â”‚ Returns decrypted messages          â”‚
â”‚ â”‚  â€¢ user_id (optional)               â”‚ Includes metadata                   â”‚
â”‚ â”‚  â€¢ limit (default: 100)             â”‚                                    â”‚
â”‚ â”‚  â€¢ start_after (pagination)         â”‚                                    â”‚
â”‚ â””â”€ Returns: {messages: [...], token}   â”‚                                    â”‚
â”‚                                        â”‚                                    â”‚
â”‚ POST /messages/batch                   â”‚ Batch message processing            â”‚
â”‚ â”œâ”€ Body: {chat_id, user_id, batch_size}â”‚ Bulk operations support            â”‚
â”‚ â””â”€ Returns: {messages: [...], count}   â”‚ Optimized for large datasets       â”‚
â”‚                                        â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ERROR HANDLING
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP STATUS CODES                                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚      2xx        â”‚  â”‚      4xx        â”‚  â”‚           5xx               â”‚ â”‚
â”‚ â”‚    SUCCESS      â”‚  â”‚   CLIENT ERROR  â”‚  â”‚       SERVER ERROR          â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚                 â”‚  â”‚                             â”‚ â”‚
â”‚ â”‚ â€¢ 200 OK        â”‚  â”‚ â€¢ 400 Bad       â”‚  â”‚ â€¢ 500 Internal Server       â”‚ â”‚
â”‚ â”‚ â€¢ 201 Created   â”‚  â”‚   Request       â”‚  â”‚   Error                     â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚ â€¢ 401 Unauthorizedâ”‚ â”‚ â€¢ 502 Bad Gateway           â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚ â€¢ 404 Not Found â”‚  â”‚ â€¢ 503 Service               â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚ â€¢ 405 Method    â”‚  â”‚   Unavailable               â”‚ â”‚
â”‚ â”‚                 â”‚  â”‚   Not Allowed   â”‚  â”‚ â€¢ 504 Gateway Timeout       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚ ERROR RESPONSE FORMAT                                                       â”‚
â”‚ {                                                                           â”‚
â”‚   "error": "Human readable error message",                                 â”‚
â”‚   "code": "ERROR_CODE_CONSTANT",                                           â”‚
â”‚   "details": {                                                             â”‚
â”‚     "field": "specific_field_with_error",                                  â”‚
â”‚     "value": "invalid_value_provided"                                      â”‚
â”‚   },                                                                       â”‚
â”‚   "timestamp": "2024-01-01T12:00:00Z",                                     â”‚
â”‚   "request_id": "uuid-for-tracking"                                        â”‚
â”‚ }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This comprehensive architecture documentation provides a detailed view of the system design, covering all major components, data flows, security considerations, and deployment strategies. The diagrams use ASCII art for universal compatibility and easy maintenance in version control. 